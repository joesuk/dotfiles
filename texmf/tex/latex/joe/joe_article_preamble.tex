%\NeedsTeXFormat{LaTeX2e}
%\ProvidesClass{joe_article}[2014/08/16 Example LaTeX class]

% misc starter packages
\usepackage{fullpage}
%\usepackage{authblk} % getting rid of this makes author list on same line
\usepackage{blindtext}
\usepackage{booktabs} % for professional tables
\usepackage{makecell} % for makecell command for line breaks in table cells
\usepackage[round]{natbib}
\usepackage{url}
\usepackage{wrapfig} % for wrapping figure inside paragraph
%\restylefloat{figure} % to allow for caption or \captionlistentry{} inside wrapfig
\usepackage{caption}

% For theorems and such
%\usepackage[amsmath]{ntheorem}
%\usepackage{thmtools}
\usepackage{amssymb}
\usepackage{mathtools}
\usepackage{amsthm}
\usepackage{nameref}
\usepackage{hyperref}
\usepackage[capitalize,noabbrev]{cleveref}


\usepackage{amsmath}
\usepackage{amsfonts}
\usepackage{graphicx}
\usepackage[right=1in,left=1in,top=1in,bottom=1in]{geometry}
\usepackage[usenames,svgnames,dvipsnames]{xcolor}
\usepackage{mathrsfs,bm}
\usepackage{amssymb}
\usepackage{titlesec}
\usepackage{tikz-cd}
\usepackage{hyperref}
\usepackage[most]{tcolorbox}
\usepackage{etoolbox}
\setlength{\parindent}{0in}
\setlength{\parskip}{0.5em}
%\usepackage{listings}
%\usepackage{color}
%\usepackage{nameref}
\usepackage{ stmaryrd }
%\usepackage{tgbonum}
%\usepackage[sfdefault]{noto}
%\usepackage[sfdefault]{roboto}
\usepackage[T1]{fontenc}
\usepackage[shortlabels]{enumitem}


\usepackage[english]{babel}
\usepackage[utf8]{inputenc}
\usepackage{fancyhdr}
\usepackage[obeyFinal,textsize=scriptsize,shadow]{todonotes}
\usepackage{mathtools}
\usepackage{microtype}
\usepackage[normalem]{ulem}
\usepackage{stmaryrd}
\usepackage{wasysym}
\usepackage{multirow}
\usepackage{prerex}
\usepackage{hyperref}
\usepackage[capitalize,noabbrev]{cleveref}


\theoremstyle{plain}
% \usepackage{titlesec}

% \titleformat{\chapter}[block]
%   {\normalfont\huge\bfseries}{\thechapter}{20pt}{}
% \titlespacing*{\chapter}
%   {0pt}{20pt}{20pt}

\setcounter{tocdepth}{5}
\setcounter{secnumdepth}{5}


\usepackage{joe_macros}


% section formatting
\titleformat{\section}[block]{\color{black}\Large\bfseries}{\thesection}{1em}{}
\titleformat{\subsection}[hang]{\color{black}\large\bfseries}{\thesubsection}{1em}{}

\titleformat{\subsubsection}[hang]{\color{black}\large\bfseries}{\thesubsubsection}{1em}{}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% THEOREMS
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\theoremstyle{plain}
\newtheorem{thm}{Theorem}
\newtheorem{theorem}[thm]{Theorem}
\newtheorem{proposition}[thm]{Proposition}
\newtheorem{prop}[thm]{Proposition}
\newtheorem{lemma}[thm]{Lemma}
\newtheorem{lem}[thm]{Lemma}
\newtheorem{corollary}[thm]{Corollary}
\newtheorem{cor}[thm]{Corollary}
%\theoremstyle{definition} % don't italicize environments in articles
\newtheorem{definition}{Definition}
%\newtheorem*{notation}[theorem]{Notation}
\newtheorem{condition}{Condition}
\newtheorem{assumption}{Assumption}
%\theoremstyle{remark}
%\theoremstyle{definition}
\newtheorem{remark}{Remark}
\newtheorem{rmk}{Remark}
\newtheorem{conj}[thm]{Conjecture}
%\newtheorem{definition}[thm]{Definition}
%\newtheorem{assumption}[thm]{Assumption}
\newtheorem*{assumption*}{Assumption}
\newtheorem{note}[thm]{Notation}
\newtheorem{defn}[thm]{Definition}
\newtheorem{fact}[thm]{Fact}
%\newtheorem{prop}[prop]{Proposition}
\newtheorem{answer}[thm]{Answer}
\newtheorem{ques}[thm]{Question}
\newtheorem{exer}[thm]{Exercise}
\newtheorem{prob}[thm]{Problem}
\newtheorem*{conj*}{Conjecture}
\newtheorem*{defn*}{Definition}
\newtheorem*{note*}{Notation}
\newtheorem*{fact*}{Fact}
%\newtheorem*{answer*}{Answer}
\newtheorem*{ques*}{Question}
\newtheorem*{exer*}{Exercise}
\newtheorem*{prob*}{Problem}
\newtheorem{algo}{Algorithm}
\newtheorem*{algo*}{Algorithm}


% solution environment
\renewcommand{\qedsymbol}{$\blacksquare$} % change qed symbol to blacksquare
\newenvironment{sol}
  {\renewcommand\qedsymbol{$\blacksquare$}\begin{proof}[Solution]}
  {\end{proof}}
\newenvironment{solution}
  {\renewcommand\qedsymbol{$\blacksquare$}\begin{proof}[Solution]}
  {\end{proof}}

% solution block
\usepackage{cleveref}
\usepackage[most]{tcolorbox}
\newtcbtheorem{solb}{Solution}{
                lower separated=false,
                colback=white!80!gray,
colframe=white, fonttitle=\bfseries,
colbacktitle=white!50!gray,
coltitle=black,
enhanced,
breakable,
boxed title style={colframe=black},
attach boxed title to top left={xshift=0.5cm,yshift=-2mm},
}{solb}


%% napkin theorem style
%\usepackage{thmtools}
%\usepackage[framemethod=TikZ]{mdframed}
%
%\theoremstyle{definition}
%\mdfdefinestyle{mdbluebox}{%
	%roundcorner = 5pt,
	%linewidth=1pt,
	%skipabove=12pt,
	%innerbottommargin=9pt,
	%skipbelow=2pt,
	%nobreak=true,
	%linecolor=RedViolet,
	%backgroundcolor=WildStrawberry!20,
%}
%\declaretheoremstyle[
	%headfont=\sffamily\bfseries\color{RoyalPurple},
	%mdframed={style=mdbluebox},
	%spaceabove=7pt,
	%headpunct={\\[5pt]},
	%postheadspace={0pt}
%]{thmbluebox}
%
%\mdfdefinestyle{mdredbox}{%
	%linewidth=0.5pt,
	%skipabove=12pt,
	%frametitleaboveskip=5pt,
	%frametitlebelowskip=0pt,
	%skipbelow=2pt,
	%frametitlefont=\bfseries,
	%innertopmargin=4pt,
	%innerbottommargin=8pt,
	%nobreak=true,
	%linecolor=PineGreen,
	%backgroundcolor=SeaGreen!10,
%}
%\mdfdefinestyle{mdanswerbox}{%
	%linewidth=0.5pt,
	%skipabove=12pt,
	%frametitleaboveskip=5pt,
	%frametitlebelowskip=0pt,
	%skipbelow=2pt,
	%frametitlefont=\bfseries,
	%innertopmargin=4pt,
	%innerbottommargin=8pt,
	%nobreak=true,
	%linecolor=Melon,
	%backgroundcolor=Dandelion!10,
%}
%\declaretheoremstyle[
	%headfont=\bfseries\color{PineGreen},
	%mdframed={style=mdredbox},
	%spaceabove=7pt,
	%headpunct={\\[3pt]},
	%postheadspace={0pt},
%]{thmredbox}
%\declaretheoremstyle[
	%headfont=\bfseries\color{RedOrange},
	%mdframed={style=mdanswerbox},
	%spaceabove=7pt,
	%headpunct={\\[3pt]},
	%postheadspace={0pt},
%]{thmanswerbox}
%
%
%
%\mdfdefinestyle{mdgreenbox}{%
	%skipabove=8pt,
	%linewidth=2pt,
	%rightline=false,
	%leftline=true,
	%topline=false,
	%bottomline=false,
	%linecolor=ForestGreen,
	%backgroundcolor=ForestGreen!5,
%}
%\declaretheoremstyle[
	%headfont=\bfseries\sffamily\color{ForestGreen!70!black},
	%bodyfont=\normalfont,
	%spaceabove=2pt,
	%spacebelow=1pt,
	%mdframed={style=mdgreenbox},
	%headpunct={ --- },
%]{thmgreenbox}
%\declaretheoremstyle[
	%headfont=\bfseries\sffamily\color{ForestGreen!70!black},
	%bodyfont=\normalfont,
	%spaceabove=2pt,
	%spacebelow=1pt,
	%mdframed={style=mdgreenbox},
	%headpunct={},
%]{thmgreenbox*}
%
%\mdfdefinestyle{mdblackbox}{%
	%skipabove=8pt,
	%linewidth=3pt,
	%rightline=false,
	%leftline=true,
	%topline=false,
	%bottomline=false,
	%linecolor=black,
	%backgroundcolor=RedViolet!5!gray!5,
%}
%\declaretheoremstyle[
	%headfont=\bfseries,
	%bodyfont=\normalfont\small,
	%spaceabove=0pt,
	%spacebelow=0pt,
	%mdframed={style=mdblackbox}
%]{thmblackbox}
%%
%%
%\declaretheorem[style=thmbluebox,name=Theorem,numberwithin=section]{thm}
%\declaretheorem[style=thmbluebox,name=Theorem,numberwithin=section]{theorem}
%\declaretheorem[style=thmbluebox,name=Lemma,sibling=thm]{lemma}
%\declaretheorem[style=thmbluebox,name=Proposition,sibling=thm]{prop}
%\declaretheorem[style=thmbluebox,name=Corollary,sibling=thm]{cor}
%\declaretheorem[style=thmbluebox,name=Theorem,numbered=no]{thm*}
%\declaretheorem[style=thmbluebox,name=Lemma,numbered=no]{lemma*}
%\declaretheorem[style=thmbluebox,name=Proposition,numbered=no]{prop*}
%\declaretheorem[style=thmbluebox,name=Corollary,numbered=no]{cor*}
%\declaretheorem[style=thmgreenbox,name=Algorithm,sibling=thm]{algo}
%\declaretheorem[style=thmgreenbox,name=Algorithm,numbered=no]{algo*}
%\declaretheorem[style=thmgreenbox,name=Claim,sibling=thm]{claim}
%\declaretheorem[style=thmgreenbox,name=Claim,numbered=no]{claim*}
%\declaretheorem[style=thmredbox,name=Example,sibling=thm]{ex}
%\declaretheorem[style=thmredbox,name=Example,numbered=no]{ex*}
%\declaretheorem[style=thmredbox,name=Example,sibling=thm]{example}
%\declaretheorem[style=thmredbox,name=Example,numbered=no]{example*}
%\declaretheorem[style=thmanswerbox,name=Answer,numbered=no]{answer}
%\declaretheorem[style=thmblackbox,name=Remark,sibling=thm]{rmk}
%\declaretheorem[style=thmblackbox,name=Remark,numbered=no]{rmk*}
%\declaretheorem[style=thmblackbox,name=Remark,sibling=thm]{remark}
%\declaretheorem[style=thmblackbox,name=Remark,numbered=no]{remark*}
%\declaretheorem[style=thmbluebox,name=Proposition,sibling=thm]{proposition}
%\declaretheorem[style=thmbluebox,name=Corollary,sibling=thm]{corollary}
%\declaretheorem[style=thmredbox,name=Example,sibling=thm]{exercise}

% cleveref setup
\Crefname{defn}{Defn.}{Defn.}
\Crefname{definition}{Defn.}{Defn.}
\Crefname{rmk}{Remark}{Remarks}
\Crefname{prop}{Proposition}{Propositions}
\Crefname{thm}{Thm.}{Thm.}
\Crefname{theorem}{Thm.}{Thm.}
\Crefname{cor}{Cor.}{Cor.}
\Crefname{lemma}{Lem.}{Lem.}
\Crefname{algo}{Alg.}{Alg.}
\Crefname{ex}{Example}{Examples}
\Crefname{answer}{Answer}{Answers}
\Crefname{ques}{Question}{Questions}
\Crefname{prob}{Problem}{Problems}
\Crefname{assumption}{Assumption}{Assumptions}
\Crefname{note}{Notation}{Notations}
\Crefname{fact}{Fact}{Facts}
\Crefname{exer}{Exercise}{Exercises}
\Crefname{conj}{Conjecture}{Conjectures}
\Crefname{claim}{Claim}{Claims}
\Crefname{figure}{Fig.}{Fig.}
\Crefname{subsection}{Subsec.}{Subsec.}
\Crefname{section}{Sec.}{Sec.}
\Crefname{appendix}{Appendix}{Appendices}
\Crefname{table}{Table}{Tables}
\crefformat{equation}{(#2#1#3)}

% algorithms stuff

% Attempt to make hyperref and algorithmic work together better:
\newcommand{\theHalgorithm}{\arabic{algorithm}}

% algorithm2e
\usepackage[algo2e, vlined, ruled, linesnumbered]{algorithm2e}
% algorithm2e commenting
%\newcommand{\com}[1]{{\color{red}\textbf{[[} #1 \textbf{]]}}}
%\newcommand\mycommfont[1]{\footnotesize\textcolor{black}{#1}}
\newcommand\mycommfont[1]{\textcolor{black}{#1}}
\SetCommentSty{mycommfont}

\usepackage{etoolbox}  % patch def of algorithmic environment
\makeatletter
\patchcmd{\algorithmic}{\addtolength{\ALC@tlm}{\leftmargin} }{\addtolength{\ALC@tlm}{\leftmargin}}{}{}
\makeatother


\newenvironment{protocol}[1][htb]
  {\renewcommand{\algorithmcfname}{Protocol}% Update algorithm name
   \begin{algorithm2e}[#1]%
   }{\end{algorithm2e}}


\newenvironment{exampl}[1][htb]
  {%\refstepcounter{examcounter}\par\medskip
  \renewcommand{\algorithmcfname}{Algorithm}
   \begin{algorithm2e}[#1]%
   }{\end{algorithm2e}}


\newenvironment{procedures}[1][htb]
  {\renewcommand{\algorithmcfname}{Procedure}% Update algorithm name
   \begin{algorithm2e}[#1]%
   }{\end{algorithm2e}}

\def\QED{{\phantom{x}} \hfill \ensuremath{\rule{1.3ex}{1.3ex}}}
\newcommand{\extraproof}[1]{\rm \trivlist

\item[\hskip \labelsep{\bf Proof of #1. }]}
\def\endextraproof{\QED \endtrivlist}

\newenvironment{rtheorem}[3][]{

\bigskip

\noindent \ifthenelse{\equal{#1}{}}{\bf #2 #3}{\bf #2 #3 (#1)}
\begin{it}
}{\end{it}}

\newcommand{\nonl}{\renewcommand{\nl}{\let\nl}}
\def\NoNumber#1{{\def\alglinenumber##1{}\State #1}\addtocounter{ALG@line}{-1}}
\newcommand{\obs}{o}

% enable do while
\SetKwRepeat{Do}{do}{while}

% number one line of align*
\newcommand\numberthis{\addtocounter{equation}{1}\tag{\theequation}}

% if you use cleveref..
%\usepackage{nameref}
%\usepackage[capitalize,noabbrev]{cleveref}
\crefname{algocf}{Algorithm}{Algorithms}
\Crefname{algocfproc}{Algorithm}{Algorithms}
\Crefname{definition}{Definition}{Definitions}

% fix algorithm2e labelling by cleverref
\crefalias{AlgoLine}{line}%
\makeatletter
\let\cref@old@stepcounter\stepcounter
\def\stepcounter#1{%
  \cref@old@stepcounter{#1}%
  \cref@constructprefix{#1}{\cref@result}%
  \@ifundefined{cref@#1@alias}%
    {\def\@tempa{#1}}%
    {\def\@tempa{\csname cref@#1@alias\endcsname}}%
  \protected@edef\cref@currentlabel{%
    [\@tempa][\arabic{#1}][\cref@result]%
    \csname p@#1\endcsname\csname the#1\endcsname}}
\makeatother

% tags for underbrace in equation
\usepackage{mathtools}% http://ctan.org/pkg/mathtools
\makeatletter
\newcommand{\mytag}[2]{%
  \text{#1}%
  \@bsphack
  \begingroup
    \@onelevel@sanitize\@currentlabelname
    \edef\@currentlabelname{%
      \expandafter\strip@period\@currentlabelname\relax.\relax\@@@%
    }%
    \protected@write\@auxout{}{%
      \string\newlabel{#2}{%
        {#1}%
        {\thepage}%
        {\@currentlabelname}%
        {\@currentHref}{}%
      }%
    }%
  \endgroup
  \@esphack
}
\makeatother



% colors and hypersetup
\definecolor{aqua}{rgb}{0.0, 1.0, 1.0}
\definecolor{caribbeangreen}{rgb}{0.0, 0.8, 0.6}
\definecolor{azure(colorwheel)}{rgb}{0.0, 0.5, 1.0}
\definecolor{charcoal}{rgb}{0.21, 0.27, 0.31}

\hypersetup{backref=true,
    pagebackref=true,
    hyperindex=true,
    colorlinks=true,
    breaklinks=true,
	citecolor=magenta,
	filecolor=black,
	linkcolor=blue,
	urlcolor=caribbeangreen,
	linkbordercolor=blue
}


% table of contents spacing
\usepackage{tocloft}
\setlength{\cftbeforesecskip}{5pt}

% citation style

% wrapfig stuff
\makeatletter
\def\clearwf{\par{\count@\c@WF@wrappedlines\zz}\par}

\def\zz{{%
\ifnum\count@>\@ne
\noindent\mbox{zz}\\%
\advance\count@\m@ne
\expandafter\zz
\else
\ifhmode\unskip\unpenalty\fi
\fi}}

\makeatother

% maketitle
%\makeatletter
%\def\@maketitle{%
    %{\LARGE \@title \bf \begin{tcolorbox}[colframe=caribbeangreen,colback=caribbeangreen!10]
%\centering \color{charcoal}
%\@title
%\end{tcolorbox}}
%}
%\makeatother

\makeatletter
\def\@maketitle{%
  \begin{center}%
  {\LARGE\centering \begin{tcolorbox}[colframe=caribbeangreen,colback=caribbeangreen!10]
		  \@title \color{charcoal}
\end{tcolorbox}
\par}%
  \end{center}%
  }
\makeatother
